{% extends 'base.html' %}

{% block content %}
  <p>Send Text</p>
  <button type="button" class="btn btn-success" id="btn-send">Send Pairings</button>
  <input type="hidden" id="groupId" value="1">

  <!-- Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" style="background: transparent; border: none">
        <div class="alert alert-success" role="alert" id="result-modal">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <div id="result-message"></div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    $("#btn-send").click(function () {
      $.ajax({
        url: '/comms/',
        method:"POST",
        data: {
          'groupId': $("#groupId").val()
        },
        dataType: 'json',
        success: function (returnData) {
          $('#resultModal').modal('show');
          if (returnData.failure) {
            var htmlString = "<ul>";
            returnData.failure.forEach(fail => {
              htmlString += `<li>${fail.userName} - ${fail.error}</li>`;
            });
            htmlString += "</ul>";
            $('#result-modal').prop('class', 'alert alert-danger');
            $('#result-message').html(`We had a few issues...${htmlString}Please make sure all group members have email addresses or phone numbers and try again.`);
            $('#btn-send').prop('disabled',false);
          }
          else {
            $('#result-message').html('Success!');
            $('#btn-send').prop('disabled',true);
          }
        }
      });
    });
  
  </script>
{% endblock content %}
{% block js %}
{% endblock %}
